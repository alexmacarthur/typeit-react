/**
  *
  * TypeIt - React
  * Author: Alex MacArthur <alex@macarthur.me> (https://macarthur.me)
  * Version: v0.0.2
  * License: GPL-2.0
  * URL: undefined
  *
  */
import{createElement as t,useRef as e,useEffect as n,useState as i}from"react";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var r=function(){return(r=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s={strings:[],speed:100,cursor:!0,cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,lifeLike:!0,breakLines:!0,startDelay:250,startDelete:!1,nextStringDelay:750,loop:!1,loopDelay:750,html:!0,waitUntilVisible:!1,beforeString:function(){},afterString:function(){},beforeStep:function(){},afterStep:function(){},afterComplete:function(){}};function u(){var t=this,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.insert=function(e,n){t.waiting.splice(e,0,n)},this.add=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t[0])?(e.waiting=e.waiting.concat(t),e):(e.waiting[n?"unshift":"push"](t),e)},this.delete=function(e){return t.waiting.splice(e,1),t},this.reset=function(){return t.waiting=t.executed.concat(t.waiting),t.executed=[],t},this.executed=[],this.waiting=n,!n.length&&i&&this.add(i)}var a=function(t){return document.createElement(t)};function c(t,e){return Math.abs(Math.random()*(t+e-(t-e))+(t-e))}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=a("style");n.id=e,n.appendChild(document.createTextNode(t)),document.head.appendChild(n)}function f(t){return t.map((function(t){return t.replace(/<\!--.*?-->/g,"")}))}var h=function(t){return["textarea","input"].indexOf(t.tagName.toLowerCase())>-1},p=function(t){return Array.isArray(t)?t:[t]},d=function(t){return[].slice.call(t)},v=function(t,e){var n=t.nextSibling;return!!n&&!n.isEqualNode(e)},y=function(t,e){var n=e;if(h(t))t.value="".concat(t.value).concat(n);else{var i=d(t.childNodes).filter((function(t){return t.classList&&t.classList.contains("ti-cursor")}));if(i=i.length?i[0]:null,"object"==o(e)&&!(e instanceof HTMLElement)){var r=e.ancestorTree.slice(0).reverse().join(" "),s=d(t.querySelectorAll("".concat(r))),u=(s=s.filter((function(t){return!i||!i.isEqualNode(t)}))).length>0?s[s.length-1]:null;if(u&&function(t,e){if(!t)return!1;for(var n=!1,i=[],r=t;!n;)i.push(v(r,e)),(r=r.parentNode)&&r.hasAttribute&&!r.hasAttribute("data-typeit-id")||(n=!0);return!i.some((function(t){return t}))}(u,i))t=u,n=e.content;else if(n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=a(t);return e.forEach((function(t){i.setAttribute(t.name,t.value)})),i.innerHTML=n,i}(e.ancestorTree[0],e.attributes,e.content),e.ancestorTree.length>1){var c=d(t.querySelectorAll(e.ancestorTree[1]));t=c[c.length-1]}}n="object"==o(n)?n:document.createTextNode(n),t.insertBefore(n,i&&t.hasAttribute("data-typeit-id")?i:null)}},g=function(t){var e=[];return e.concat.apply(e,t)},m=function(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body},b=function(t){return d(t.childNodes).map((function(t){return 3===t.nodeType?t.nodeValue.split(""):t}))},w=function(t,e,n){return{ancestorTree:e,attributes:(i=t,d(i.attributes).map((function(t){return{name:t.name,value:t.nodeValue}}))),content:n};var i},S=function(t,e){var n=w(t,e,""),i=b(t).map((function(n,i){return Array.isArray(n)?n.map((function(n,i){return w(t,e,n)})):n}));return i.unshift(n),g(i)},q=function(t){return t instanceof HTMLElement&&"BR"!==t.tagName},A=function t(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.map((function(t){if(q(t)){if(!n)return d(t.childNodes);for(var e=t.parentNode,i=[t.tagName];["BODY","HTML"].indexOf(e.tagName)<0;)i.push(e.tagName),e=e.parentNode;return S(t,i)}return t}));return(i=g(i)).some((function(t){return q(t)}))?t(i,n):i};function T(t){var e=m(t),n=b(e);return A(n)}function N(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?T(t):t.split("")}var L=function(t,e){e?t.value="":t.querySelector(".ti-cursor")&&(t.innerHTML="")},x=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!Array.isArray(t),r=t.length;return(t=i?new Array(t).fill(0):t).map((function(t,o){if(i)return e;var s=[e,t];return n&&(0===o&&s.push({isFirst:!0}),o+1===r&&s.push({isLast:!0})),s}))},O=function(t){t.parentNode.removeChild(t)},E=function(t){return 3!==t.nodeType&&"BR"!==t.tagName&&!t.firstChild},D=function(t){return t.some((function(t){return E(t)}))},$=function(t){for(var e=d(t.querySelectorAll("*")),n=D(e);e.length&&n;){var i=!1;e.forEach((function(t){E(t)&&(O(t),i=!0)})),i&&(e=d(t.querySelectorAll("*"))),n=D(e)}return e},M=function(t){return Array.isArray(t)||(t=[t/2,t/2]),{before:t[0],after:t[1],total:t[0]+t[1]}};function P(t,e,n){var i=(e=null!==e?e:t/3)/2;return n?[c(t,t/2),c(e,i)]:[t,e]}function I(){var t=this,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.typeIt,r=n.element,c=n.id,v=n.options,g=n.queue,b=void 0===g?[]:g,w=n.isAReset,S=void 0!==w&&w,q=function(){var e=d(t.$e.childNodes).filter((function(t){return!t.isEqualNode(k)}));return A(e,!1)},E=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=e.opts.nextStringDelay;e.queue.insert(t,[e.pause,i.before]),e.queue.insert(t+n+1,[e.pause,i.after])},D=function(){!B&&t.opts.cursor&&(l("@keyframes blink-".concat(c," { 0% {opacity: 0} 49% {opacity: 0} 50% {opacity: 1} }[data-typeit-id='").concat(c,"'] .ti-cursor { animation: blink-").concat(c," ").concat(t.opts.cursorSpeed/1e3,"s infinite; }"),c),(k=a("span")).innerHTML=m(t.opts.cursorChar).innerHTML,k.className="ti-cursor",k.setAttribute("style","display:inline;position:relative;font:inherit;color:inherit;line-height:inherit;"),t.$e.appendChild(k))};this.wait=function(t,e){this.timeouts.push(setTimeout(t,e))};var j=function(){t.opts.strings.forEach((function(e,n){var i=N(e,t.opts.html);t.queue.add(x(i,t.type,!0));var r=t.queue.waiting.length;if(n+1!==t.opts.strings.length){if(t.opts.breakLines)return t.queue.add([t.type,a("BR")]),void E(r);t.queue.add(x(i,t.delete)),E(r,e.length)}}))},H=function(e){t.queue.reset().delete(0).add([t.pause,e.before],!0);for(var n=0;n<q().length;n++)t.queue.add([t.delete,null,{isPhantom:!0}],!0)},C=function(e){var n=t.$e.innerHTML;return n?(t.$e.innerHTML="",t.opts.startDelete?(T(n).forEach((function(e){y(t.$e,e)})),t.queue.add([t.delete,!0]),E(1),e):[n.trim()].concat(e)):e};this.pause=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(n,i){t.wait((function(){return n()}),e||t.opts.nextStringDelay.total)}))},this.reset=function(){return this.queue.reset(),new I({typeIt:i,element:this.$e,id:c,options:this.opts,queue:this.queue.waiting,isAReset:!0})},this.init=function(){var t=this;if(!this.status.started){if(D(),!this.opts.waitUntilVisible)return this.status.started=!0,this.fire();new IntersectionObserver((function(e,n){e.forEach((function(e){e.isIntersecting&&(t.fire(),n.unobserve(t.$e))}))}),{threshold:1}).observe(this.$e)}},this.fire=function(){for(var t=this,e=this,n=this.queue.waiting.slice(),r=Promise.resolve(),o=function(t){var o=n[t],s=[o,e.queue,i];r=r.then((function(){return new Promise((function(t,n){var i,r;if(e.status.frozen)return n();e.pace=P(e.opts.speed,e.opts.deleteSpeed,e.opts.lifeLike),o[2]&&o[2].isFirst&&(i=e.opts).beforeString.apply(i,s),(r=e.opts).beforeStep.apply(r,s),o[0].call(e,o[1],o[2]).then((function(){var n,i,r=e.queue.waiting.shift();return o[2]&&o[2].isPhantom?t():(o[2]&&o[2].isLast&&(n=e.opts).afterString.apply(n,s),(i=e.opts).afterStep.apply(i,s),e.queue.executed.push(r),t())}))}))}))},s=0;s<n.length;s++)o(s);r.then((function(){if(t.opts.loop){var e=t.opts.loopDelay?t.opts.loopDelay:t.opts.nextStringDelay;t.wait((function(){H(e),t.fire()}),e.after)}t.status.completed=!0,t.opts.afterComplete(i)})).catch((function(){}))},this.type=function(t){var e=this;return"object"!=o(t)||t.content?new Promise((function(n){e.wait((function(){return y(e.$e,t),n()}),e.pace[0])})):(y(this.$e,t),Promise.resolve())},this.empty=function(){var t=this;return new Promise((function(e){return B?t.$e.value="":d(t.$e.childNodes).forEach((function(t){k.isEqualNode(t)||O(t)})),e()}))},this.delete=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(n){t.wait((function(){var i=q();return i.length&&O(i[i.length-1]),$(t.$e),e&&i.length-1>0?t.delete(!0).then((function(){return n()})):n()}),t.pace[1])}))},this.setOptions=function(t){var e=this;return new Promise((function(n){return e.opts=Object.assign({},e.opts,t),n()}))};var k=null,B=h(r);this.status={started:!1,complete:!1,frozen:!1,destroyed:!1},this.$e=r,this.timeouts=[],this.opts=Object.assign({},s,v),this.opts.html=!B&&this.opts.html,this.opts.nextStringDelay=M(this.opts.nextStringDelay),this.opts.loopDelay=M(this.opts.loopDelay),this.queue=new u(b,[this.pause,this.opts.startDelay]),this.$e.setAttribute("data-typeit-id",c),l("[data-typeit-id]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}"),L(r,B);var R=p(this.opts.strings);R=C(R),this.opts.strings=f(R),this.opts.strings.length&&!S&&j()}function j(t,e){var n,i=this,r=this;this.instances=(n=t,"string"==typeof n?n=document.querySelectorAll(n):n.forEach||(n=[n]),d(n)).map((function(t){return new I({typeIt:i,element:t,id:Math.random().toString(36).substring(2,15),options:e,queue:[],isAReset:!1})}));var o=function(t){i.instances.forEach((function(e){t.call(i,e)}))},s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;o((function(i){var o="string"!=typeof t,s=o?t:i[t],u=x(n,[s,o?r:e]);i.queue.add(u)}))};this.is=function(t){return e=this.instances,n=t,!0,!!e.length&&!e.some((function(t){return!0!==t.status[n]}));var e,n},this.freeze=function(){o((function(t){t.status.frozen=!0}))},this.unfreeze=function(){o((function(t){t.status.frozen&&(t.status.frozen=!1,t.fire())}))},this.type=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o((function(e){var n=N(t,e.opts.html);e.queue.add(x(n,e.type,!0))})),this},this.delete=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return s("delete",null===t,null===t?1:t),this},this.pause=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return s("pause",t),this},this.break=function(){return s("type",a("BR")),this},this.options=function(t){return s("setOptions",t),this},this.exec=function(t){return s(t),this},this.destroy=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.instances=this.instances.map((function(e){if(e.timeouts.forEach((function(t){clearTimeout(t)})),e.timeouts=[],t){var n=e.isInput?null:e.$e.querySelector(".ti-cursor");n&&e.$e.removeChild(n)}return e.status.destroyed=!0,e}))},this.empty=function(){return s("empty"),this},this.reset=function(){return this.destroy(),this.instances=this.instances.map((function(t){return t.reset()})),this},this.go=function(){return o((function(t){t.init()})),this}}var H=e,C=n,k=i,B=function(e){var n=k(!0),i=n[0],o=n[1],s=H(null),u=e.options,a=e.element,c=e.children,l=e.getBeforeInit,f=e.getAfterInit,h=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(e,["options","element","children","getBeforeInit","getAfterInit"]),p=a;return C((function(){c&&(u.strings=s.current.innerHTML),o(!1)}),[]),C((function(){if(!i){var t=new j(s.current,r({},u));return(t=l(t)).go(),t=f(t),function(){t.destroy()}}}),[i]),t("div",{style:{opacity:i?0:1}},t(p,r({ref:s},h),i&&c))};B.defaultProps={element:"span",options:{},getBeforeInit:function(t){return t},getAfterInit:function(t){return t}};export default B;
